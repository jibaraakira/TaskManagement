# 日誌作成アプリの作成日誌



## 作業時間

| 番号 | 開始時間                 | 終了時間            | 内容や備考                                                   |
| ---- | ------------------------ | ------------------- | ------------------------------------------------------------ |
| 1    | 2022-12-01_20:00（予想） | 2022-12-02_02:14:45 | DB設計、画面を簡単に作る                                     |
| 2    | 2022-12-02_18:29:35      | 2022-12-02_21:19:31 | 画面を作る。                                                 |
| 3    | 2022-12-03_16:56:55      | 2022-12-02_20:30    | 画面を作成。MVVM的にコードを整える。                         |
| 4    | 2022-12-04_21:05:11      | 2022-12-05_03:18:14 | 画面を作成。ICOMMANDで、メモ一覧の追加と削除の起点ができた。 |
| 5    | 2022-12-05_20:57:53      | 2022-12-06_01:28:10 | 画面を作成。階層的な表示のチェック一覧に、追加機能の途中。   |
| 6    | 2022-12-06_22:03:56      | 2022-12-07_01:58:33 | 画面を作成。階層的な表示のチェック一覧に、行を追加をいくつか実装したが、まだ途中である。 |
| 7    | 2022-12-07_21:17:43      | 2022-12-08_00:31:03 | 画面を作成。階層的な表示のチェック一覧に、選んだ行の子要素を追加したり、削除したりできるようになった。 |
| 8    | 2022-12-08_19:37:18      | 2022-12-09_00:31:10 | 画面の作成。                                                 |
| 9    | 2022-12-09_20:25:50      | 2022-12-10_00:03:32 | 画面の作成。固定メモの実装。コメントを書く。                 |
|      |                          |                     |                                                              |



## 全体日誌

### 2022-12-01

これまで、自分はシステムの開発について、タイポラにて日付順に記録していたが、タスクが日をまたぐ時の不自然さが目についた。これは、マークダウンという表記が、日付という次元しか表現できない構造だからだ。これを解決するには、一覧形式で表示したら良く、エクセルに簡単に実現できる。しかし、エクセルでは長文を見ることができない構造であり、これはタイポラの長所である。

今回開発するアプリは、エクセルのように一覧形式でタスクや時期を分類するも、タスクの履歴をタイポらのように表示、また記録ができるようにするアプリを開発する。

今日は、画面を開発する。

### 2022-12-02

2022-12-02_00:03:39

DBを作成した。

次にこの日誌の見出し2「画面設計」を設けて、そこに、画面をオーダーを書く。



2022-12-02_02:17:40

次回メモ

- チェックリストは、datagridにすること
- また、Wrappできること
- メモ一覧は、ListBoxを書き換えることで実現すること
- クラスを作り、値を実際入れて作成すること。



2022-12-02_18:29:54

この日誌の見出し２「要件定義」を設けて、要件定義を書く。



2022-12-02_18:58:09

画面をWPFを作成する。



### 2022-12-03

2022-12-03_16:57:58

今日のタスクは、画面のWPFを作成である。目標としては、次の通り

- 見た目を変える。
  - タイトルをすべて縦横中央寄せにする
  - 一覧の中身も、中央寄せにするべきはそうする。
- タスク一覧の動的なものを作成する。
  - 初期表示を次のように設定する
    - 検索セクションにおいて、カレンダーを、今日の日付にして、状態を、進捗中と表示する。
    - タスク一覧には、今日の日付で、進捗中のもの飲みを表示する。
- タイプを
- 以上の内容を、画面設計の文章に書き入れる。



2022-12-03_21:35:03

タスク一覧の昨日は次のように決めた

- 編集はボタンを押して切り替えてモードを切り替える
- 編集する度に、DBを更新する
- 絞り込み検索をかけるときは、その度にSQLを呼び出して作成する。



2022-12-03_21:40:04

状態を検索するコンボボックスのバインドを修正する。



### 2022-12-04

2022-12-04_21:28:49

画面の、次のところを作成する。

- メモ一覧
  - 追加ボタン
  - メモごとに削除ボタンをくっつけて、表示した様子を削除する。
- チェックリスト一覧
  - 追加、削除ができるようにする。



### 2022-12-05

画面の、次のところを作成する。

- チェックリスト一覧
  - 追加、削除ができるようにする。



### 2022-12-06

2022-12-06_01:28:10

次回メモ

- チェックリスト一覧の追加処理の修正。えらんだ１つ下に追加の実装と、追加処理を担うコマンドの追加処理の修正。



2022-12-06_23:52:29

やったこと

- [x] 行を追加するコマンドに、すべてのコマンド(完了:2022-12-06_23:54:46)
- [x] チェック一覧の表示の前処理を実装(完了:2022-12-07_01:56:06)
  - [x] DBから情報を受け取るとき、多分その順番は階層パスどおりでないはずだから、そのとおりに修正するコードを作成する。多分、パスを再帰的に分析して並び替えるアルゴリズムがあるはず。(完了:2022-12-07_01:56:06)

### 2022-12-07

21:25:09

画面を作成する

子要素を追加する。

- [x] 子要素を追加するべき行にそのボタンを表示して、そうでないのはボタンを非表示にする。(完了:2022-12-07_23:52:37)
- [x] 削除。(完了:2022-12-07_23:52:37)



### 2022-12-08

2022-12-08_19:37:18

タスク一覧セクション

- [x] 削除ボタンの追加。(完了:2022-12-08_19:43:37)
- [x] 固定メモの作成。(完了:2022-12-08_21:28:39)
- [ ] 削除処理の実装。(完了:2022-12-08_22:40:29)



2022-12-08_22:40:41

コードを修正する。というのも、モデルビュークラスにビュークラスを注入していて、これでは疎結合にならない。そこで、それを利用しないコードに修正する。

- [x] 一覧画面の削除処理(完了:2022-12-08_23:22:36)



2022-12-08_23:22:51

モデルビュークラスを書き換えた。詳細は、「ソースに書く。」



### 2022-12-09

2022-12-09_00:31:10

次回の実装

- 固定メモの作り込み。
- チェックリストの項目がすべてなくなったら、最初の１項木目を作成する。
- メモ一覧の項目がすべてなくなったら、最初の１項木目を作成する。
- コメントを書き込む。
- DBの作成
- ORマッパーの導入



2022-12-09_20:27:15

修正

- [x] メモ一覧を消すときに、Commandparameterを更新する。(完了:2022-12-09_21:23:59)
- [x] 固定メモの作り込み。(完了:2022-12-09_22:35:11)
  - [x] セクションの追加と削除をする。(完了:2022-12-09_22:35:11)
- [ ] 書ききれなかったコメントを書く。(完了:)
- [x] ORマッパーの導入。(完了:2022-12-10_00:00:58)



2022-12-10_00:04:22

次回でやること

- 各一覧のindex値の更新
- チェックリストの項目がすべてなくなったら、最初の１項木目を作成する。
- 固定メモの見出しをtextboxに変更する。
- 





## 要件定義

アプリに次を求める。

- タスクの記録と確認ができる
  - タスクを追加、更新、削除ができる。
  - タスクを次の単位で確認できる。その日単位や、設定したタグ単位や、状態単位である。
- タスクの進捗の詳細が見れる
  - タスクについてのメモができ、それが時列に表示される。
  - タスクに階差構造のチェックリストを表示して、何が終わったかを調べる。







## 画面について

### 設計

アプリは、画面は１つだけであり、その中で以下の４つのセクションに分けられる。

- １つ目は、タスクが確認できる一覧。
  - 名前を「タスク一覧」である。
  - 構成としては、複数の、タスクを検索する画面要素が集まったセクションと、タスクを一覧に表示するセクションに分かれる。
  - 機能としては、
    - 日付やタグ、完成状態などで絞り込み検索ができる。
    - タスクを一覧画面にする。
    - 検索パターンを覚える事ができ、それを選択すると、検索ができる。
    - タスクを書き換えたり、入力できたりする。
- ２つ目は、チェックリストである。タスクの経過をチェックして確認するための一覧である。
- ３つ目は、固定メモである。タスクの意義などを書き込むものである。
- ４つ目は、文字記録を閲覧するコレクション画面である。タスクに対する文字記録が確認でき、また記録ができる。



### 進捗

2022-12-02_18:58:09

画面をWPFを作成する。

- [x] ListBoxの横幅をフレキシブルに固定する(完了:2022-12-02_19:06:36)
- [x] チェックリストをTreeViewで表示する(完了:2022-12-03_16:54:43)
  - [x] 時間を表示する。(完了:2022-12-02_20:44:34)

- [x] タスク一覧を整理する。(完了:2022-12-02_20:44:34)



2022-12-03_16:57:58

画面のWPFを作成する

- [x] 見た目を変える(完了:2022-12-03_19:06:17)
  - [x] タイトルをすべて縦横中央寄せにする。(完了:2022-12-03_18:52:41)
  - [x] 一覧の中身も、中央寄せにするべきはそうする。(完了:2022-12-03_19:06:17)
    - [x] 状態列のコンボボックスを縦横中央にした(完了:2022-12-03_19:06:17)
  - [x] 状態は、コンボボックスとして表示する。(完了:2022-12-03_18:54:17)
    - [x] 表示するときに、データの中身を反映する。(完了:2022-12-03_18:53:04)
    - [x] データバインの技で実現する。(完了:2022-12-03_18:54:17)
- [ ] タスク一覧の動的なものを作成する。
  - [ ] 初期表示を次のように設定する。(完了:)
    - [x] 検索セクションにおいて、カレンダーを、今日の日付にして、状態は空白にする。(完了:2022-12-03_21:23:45)



2022-12-04_21:28:49

- [x] メモ一覧(完了:)
  - [x] 追加ボタン。(完了:2022-12-05_00:51:40)
  - [x] メモごとに削除ボタンをくっつけて、表示した様子を削除する。(完了:2022-12-05_02:37:24)



2022-12-05_21:00:57

- [x] チェックリスト一覧(完了:2022-12-09_00:33:37)
  - [x] 作成時間を表示する。(完了:2022-12-06_00:59:28)
  - [x] 追加、削除ができるようにする。(完了:2022-12-09_00:33:37)
    - [x] 選択した行のひとつ上に追加(完了:2022-12-06_00:59:28)
    - [x] 選択した行のひとつ下に追加(完了:2022-12-06_00:59:28)
    - [x] 自分の子要素として追加したい。(完了:忘れた！)



2022-12-08_23:22:51

固定メモを追加した。加えて、「画面」の「設計」を書き換える。







## ソースについて



### 進捗

2022-12-03_16:57:15

「2022-12-02_18:58:09」の時点で、DTOであるクラス「Memo」と「Task」が作成された。



2022-12-03_17:22:06

つくっているあぷり、思ったより、画面を操作するようだ。よって、セクションごとに操作するためのクラスを書こう。そのほうが、何をするのか、はっきりする。例えば、今日の目標だと、検索セクションは色々と操作するもようだから、その操作を１ソースにまとめるほうがよりわかりやすいことであろう。



2022-12-03_17:30:12

DTOソースを置くファイルと、画面を操作するソースのファイルを置いた。



2022-12-03_19:38:26

今まで書いたコードを、ViewModelモデルに書き直した。



2022-12-03_21:34:19

コンボボックスのバインドのコードを修正する。



2022-12-08_00:08:44

チェック一覧に新規追加する行データの階層パスを作成するコードが必要と感じた。

それは、DBに行データを追加するために必要だからである。

一応、現在では、追加された行データのパスは次の処理で作られている。つまり、一旦行データを木構造のリストに組み込み、そこに再帰処理メソッドですべての階層パスを書き換える流れで作られている。

しかし、木構造のリストを参照して階層パスを取得するのが、少し抵抗がある。また再帰処理するのか、とおもったら、面倒に思える。しかも、このために作ろうとしている階層パス作成処理は、それほど難しくないもtの想定している。



2022-12-08_00:18:59

チェック一覧の再帰処理を修正した。処理のif文で、行データクラスのフィールドの子要素のコレクション変数をみて、その行テータに１つ以上の子要素があるか否かの判断を変えた。変更前はnull値か否かのところ、うまくいかなかったので、変更後の今は、コレクションの長さが０か否かにした。



2022-12-08_23:22:51

モデルビュークラスを次のように書き換える。そのクラスには現在、タスク一覧、チェックリスト、メモ一覧の3つのセクションそれぞれに対してデータバインドする変数などが、全て一緒に書かれている。しかし、これでは煩雑になる。そこで、３つのセクションごとに新しいクラスを作り、データバインドする変数を外だしにして関連するクラスごとに分ける。

- [x] モデルビュークラスを書き換えた。(完了:2022-12-09_00:24:04)



2022-12-08_23:22:51

DAOクラスを２つ作る。チェック一覧と、メモ一覧のものである。実装はまだモック的に作っていて、具体的に作っていない。







## 動作について

### 画面の動きについて

#### 全体一覧

2022-12-05_00:54:16

画面はMVVMで作成する。xamlのViewにたいして、バインディングを通じて、ViewModelクラスを通じて、値を入れていく。Viewには、最小限度の動作と、画面のイベントも、MVVM的にする。例えばボタンをICOMMANDを使ったものにした。



### チェック一覧

1. (2022-12-06_01:02:13~2022-12-06_01:20:45)チェック一覧の行それぞれには、新要素の追加（選んだ行の１つ上または１つ下）は、まず選を選び、ボタンを押す（１つ上なら「↑」ボタン、１つ下なら「↓」ボタン）の階層パスとその行があるコレクションを、一覧を表示するためのリスト(木構造）から再帰的に取得し、そこからコレクションに新しい行の情報を、選んだ行の一つ前または後に挿入する。その後、リスト(木構造）を再帰的に処理するメソッドで、それそれの行の持つ階層パスを更新する。
1. (2022-12-07_01:59:35~)チェック一覧にバインドをする前の処理として、DBから取得したチェック一覧ほ行データを指定した階層にそって木構造的にデータを配置処理がある。処理内容としては、行データごとにある階層のパスの数値を利用して、再帰的に並べる。



#### メモ一覧

1. （2022-12-05_00:54:16）メモ一覧はListBoxのTaskViewListに、ビューモデルのMainVindowViewModelのTaskListリストをバインドすることで表示される。
2. （2022-12-05_00:54:16）「＋追加する」ボタンはICommnandを実装したCreateMemoCommandクラスで動作する。クリックすると、メモ一覧はメモが追加され、スクロールを一番下にされる。
3. (2022-12-05_02:33:04) 一覧にある各メモにある「消去」ボタンは、一覧ListViewListにバインドするコレクションNoteListの要素となるDTOのNoteにDeleteNoteCommandフィールドにDeleteNoteCommandのインスタンスをセットして、使えるようにしている。





## 今後修正や追加するするべき処理の一覧

| 日付                | 修正点                                                       | 完了 |
| ------------------- | ------------------------------------------------------------ | ---- |
| 2022-12-07_02:05:09 | チェック一覧の行のデータの階層パスは、int型の配列に変える。その前提で書いたコードもそれに修正する。 |      |
| 2022-12-08_00:01:42 | チェック一覧に新規追加する階層パスを作成するコードを書く。そうしないとDBに保存できない。 |      |
|                     |                                                              |      |





## 今後実装する予定の機能



| 日付                | 画面箇所                               | 内容                                                         | 完了                |
| ------------------- | -------------------------------------- | ------------------------------------------------------------ | ------------------- |
| 2022-12-03_17:36:07 | タスク一覧の検索セクション             | 状態の検索だが、状態が複数の対応をなんとかしたい。多分、コンボボックスに、複数のものを仕込めば良い。 | 2022-12-03_21:22:31 |
| 2022-12-03_21:21:32 | チェックリストとメモ一覧               | チェックリスとメモ一覧を紐づけるようにする。                 |                     |
| 2022-12-06_01:02:13 | タスク一覧とチェックリストのセクション | リストに一つもアイテムが無いときの、追加操作を実装する。     |                     |
| 2022-12-09_00:24:04 | 固定メモ                               | 固定メモを、小さな見出しで分けられる用にする。大方は、メモ一覧と同様にする。また、見出しがすべて消されたら、最初の１つ目を自動で追加する。 |                     |

